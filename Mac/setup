#!/bin/sh

ruledir="$HOME/.config/karabiner/assets/complex_modifications"
mkdir -p "$ruledir"
sed "s/IS_TERMINAL/[{ \
\"type\": \"frontmost_application_if\", \
\"bundle_identifiers\": \
[\"^com\\\\\\\\.googlecode\\\\\\\\.iterm2\$\", \
\"^com\\\\\\\\.apple\\\\\\\\.Terminal\$\"]}]/" \
    "$(dirname "$0")/taemin.json.in" >"$ruledir/taemin.json"

# Make rebase safer on MacOS
# For more details see https://www.git-tower.com/blog/make-git-rebase-safe-on-osx/
git config --global core.trustctime false

echo '

# MacPorts bash-completion
# See https://trac.macports.org/wiki/howto/bash-completion
# To enable git completion, you need to install the MacPorts Git with +bash_completion option
# See https://github.com/bobthecow/git-flow-completion/wiki/Install-Bash-git-completion#macports
if [ -f /opt/local/etc/profile.d/bash_completion.sh ]; then
    . /opt/local/etc/profile.d/bash_completion.sh
fi
' >>~/.bashrc

if ! grep -qE 'auth\s+sufficient\s+pam_tid\.so' /etc/pam.d/sudo
then
    echo "Add 'auth sufficient pam_tid.so' into /etc/pam.d/sudo to enable TouchID for sudo" >&2
fi
